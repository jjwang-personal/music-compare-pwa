// /Users/jingjuewang/music-compare-pwa/app.js

function renderSegments() {
  els.anchors.innerHTML = '';

  // 添加“整曲播放（从头）”按钮（默认高亮）
  const fullChip = document.createElement('button');
  fullChip.className = 'anchor primary';
  fullChip.textContent = '整曲播放（从头）';
  fullChip.dataset.id = 'full_piece';
  els.anchors.appendChild(fullChip);

  // 渲染各段落
  (state.data.segments || []).forEach(a => {
    const chip = document.createElement('button');
    chip.className = 'anchor';
    chip.textContent = a.label || secLabel(a.startSec);
    chip.dataset.id = a.id;
    els.anchors.appendChild(chip);
  });

  // 初始高亮：如果尚未选择段落，则高亮“整曲播放”
  syncActiveAnchor();
}

function wireAnchors() {
  els.anchors.addEventListener('click', (e) => {
    const chip = e.target.closest('button[data-id]');
    if (!chip) return;
    const id = chip.dataset.id;
    if (id === 'full_piece') {
      playFullPieceFromStart();
      return;
    }
    jumpToSegment(id);
  });
}

/** 退出分段模式：整曲从头播放 */
function playFullPieceFromStart() {
  state.currentAnchorId = null;   // 清空当前段落选择
  if (typeof stopEndWatch === 'function') stopEndWatch(); // 停止段末暂停监控
  if (ytPlayer) {
    ytPlayer.seekTo(0, true);
    ytPlayer.playVideo();
  }
  syncActiveAnchor();
}

function syncActiveAnchor() {
  const chips = [...els.anchors.children];
  chips.forEach(chip => {
    const isFull = chip.dataset.id === 'full_piece';
    const active = state.currentAnchorId ? (chip.dataset.id === state.currentAnchorId) : isFull;
    chip.classList.toggle('active', active);
  });
}


// /Users/jingjuewang/music-compare-pwa/styles.css

/* existing styles... */

.anchor.primary {
  background: #4da3ff;
  border-color: #6bb3ff;
  color: #0c1b2a;
  box-shadow: 0 0 10px rgba(77,163,255,0.35);
}
.anchor.primary.active {
  background: #2d8eff;
  color: #fff;
}
